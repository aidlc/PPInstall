

|                           |                             |          |                                             |                               |
| ------------------------- | --------------------------- | -------- | ------------------------------------------- | ----------------------------- |
| ユーザー情報テーブル                |                             |          |                                             |                               |
| user_table                |                             |          |                                             |                               |
| フィールド名                    | データ型                        | Null許容   | 制約/説明                                       | 備考                            |
| user_id                   | BIGINT UNSIGNED             | NOT NULL | PRIMARY KEY<br> (AUTO_INCREMENT)            | ユーザーを一意に識別                    |
| display_name              | VARCHAR(100)                | NOT NULL | StreamlitのUIで表示される名前                        | st.session_state['user_name'] |
| username                  | VARCHAR(100)                | NOT NULL | UNIQUE                                      | ログインやシステム内部で利用されるユーザー名        |
| user_group                | ENUM('ADMIN','USER')        | NULL     | 権限管理に利用                                     |                               |
| email                     | VARCHAR(255)                | NULL     | UNIQUE                                      | ユーザーの連絡先メールアドレス               |
| password_hash             | VARCHAR(255)                | NOT NULL | パスワードのハッシュ値                                 |                               |
| password_plaintext        | VARCHAR(255)                | NULL     | パスワード                                       |                               |
| created_at                | TIMESTAMP                   | NOT NULL | DEFAULT<br> CURRENT_TIMESTAMP               | レコード作成日時                      |
| updated_at                | TIMESTAMP                   | NOT NULL | ON UPDATE<br> CURRENT_TIMESTAMP             | 最後に更新された日時                    |
|                           |                             |          |                                             |                               |
| 会話ヘッダーテーブル                |                             |          |                                             |                               |
| conversation_header_table |                             |          |                                             |                               |
| フィールド名                    | データ型                        | Null許容   | 制約/説明                                       | 備考                            |
| conversation_id           | BIGINT UNSIGNED             | NOT NULL | PRIMARY KEY<br> (AUTO_INCREMENT)            | 会話を一意に識別                      |
| user_id                   | BIGINT UNSIGNED             | NOT NULL | FOREIGN KEY<br> (user_table)                |                               |
| title_summary             | VARCHAR(255)                | NOT NULL | 会話の要約/タイトル                                  |                               |
| created_at                | TIMESTAMP                   | NOT NULL | DEFAULT<br> CURRENT_TIMESTAMP               | 会話開始日時                        |
| updated_at                | TIMESTAMP                   | NOT NULL | ON UPDATE<br> CURRENT_TIMESTAMP             | 最後に更新された日時                    |
| total_messages            | INT                         | NOT NULL | メッセージ総数                                     |                               |
|                           |                             |          |                                             |                               |
| メッセージ詳細テーブル               |                             |          |                                             |                               |
| message_detail_table      |                             |          |                                             |                               |
| フィールド名                    | データ型                        | Null許容   | 制約/説明                                       | 備考                            |
| message_record_id         | BIGINT UNSIGNED             | NOT NULL | PRIMARY KEY<br> (AUTO_INCREMENT)            | メッセージを一意に識別                   |
| conversation_id           | BIGINT UNSIGNED             | NOT NULL | FOREIGN KEY<br> (conversation_header_table) | 所属する会話                        |
| message_index             | INT                         | NOT NULL | 会話内順序                                       | 1,2,3...                      |
| message_type              | ENUM('HUMAN','LLM')         | NOT NULL | メッセージ種別                                     |                               |
| content                   | MEDIUMTEXT                  | NOT NULL | メッセージ内容                                     |                               |
| timestamp                 | TIMESTAMP                   | NOT NULL | DEFAULT<br> CURRENT_TIMESTAMP               | 記録日時                          |
| feedback                  | ENUM('GOOD','NORMAL','BAD') | NULL     | AI応答評価                                      |                               |
| response_time_ms          | INT                         | NULL     | LLM回答時間(ms)                                 |                               |
|                           |                             |          |                                             |                               |
| RAGコンテキストテーブル             |                             |          |                                             |                               |
| rag_context_table         |                             |          |                                             |                               |
| フィールド名                    | データ型                        | Null許容   | 制約/説明                                       | 備考                            |
| rag_id                    | BIGINT UNSIGNED             | NOT NULL | PRIMARY KEY<br> (AUTO_INCREMENT)            | RAGレコード識別                     |
| message_record_id         | BIGINT UNSIGNED             | NOT NULL | FOREIGN KEY<br> (message_detail_table)      | 関連メッセージ                       |
| source_name               | VARCHAR(255)                | NOT NULL | ファイル名やデータソース                                |                               |
| content                   | LONGTEXT                    | NOT NULL | RAGで取得した内容                                  |                               |
| score                     | FLOAT                       | NULL     | 検索関連度                                       |                               |
